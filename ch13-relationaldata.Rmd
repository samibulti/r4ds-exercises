---
title: "Chapter 13: Relational data"
output: html_notebook
---

# 13.2 `nycflights13`

## 13.2.1 Exercises

```{r}
library(tidyverse)
library(nycflights13)
```

1. Imagine you wanted to draw (approximately) the route each plane flies from its origin to its destination. What variables would you need? What tables would you need to combine?

**You would need `origin` and `dest` for each flight, along with the `lat` and `long` for each origin and destination airport. This means that you would need to combine the `flights` and `airports` tables.**

2. I forgot to draw the relationship between `weather` and `airports`. What is the relationship and how should it appear in the diagram?

**`origin` in `weather` connects to `faa` in `airports`.**

3. `weather` only contains information for the origin (NYC) airports. If it contained weather records for all airports in the USA, what additional relation would it define with flights?

**It would connect with `dest` in `flights`so that weather records for the destination airport could be identified as well.**

4. We know that some days of the year are “special”, and fewer people than usual fly on them. How might you represent that data as a data frame? What would be the primary keys of that table? How would it connect to the existing tables?

**You could have a `specialdays` table with a `dayname` as its primary key and then connect to `flights` via `year`, `month` and `day` variables.**

# 13.3 Keys

## 13.3.1 Exercises

1. Add a surrogate key to `flights`.

```{r}
flights <- flights %>%
  mutate(flight_id = row_number())
flights %>%
  count(flight_id) %>%
  filter(n > 1)
```

2. Identify the keys in the following datasets

  1. `Lahman::Batting`,
  2. `babynames::babynames`
  3. `nasaweather::atmos`
  4. `fueleconomy::vehicles`
  5. `ggplot2::diamonds`

(You might need to install some packages and read some documentation.)

```{r}
library(Lahman)
Batting
```

```{r}
Batting %>%
  count(playerID, yearID, stint) %>%
  filter(n > 1)
```

```{r}
library(babynames)
babynames
```

```{r}
babynames %>%
  count(year, sex, name) %>%
  filter(nn > 1)
```

```{r}
library(nasaweather)
atmos
```

```{r}
atmos %>%
  count(lat, long, year, month) %>%
  filter(n > 1)
```

```{r}
library(fueleconomy)
vehicles
```

```{r}
vehicles %>%
  count(id) %>%
  filter(n > 1)
```

```{r}
diamonds
```

**This doesn't appear to have a primary key because each combination of diamond attributes wouldn't be guaranteed to be unique (even if they are unique within the current data set). It would be best to create a surrogate key.**

```{r}
diamonds <- diamonds %>%
  mutate(id = row_number())
```

3. Draw a diagram illustrating the connections between the `Batting`, `Master`, and `Salaries` tables in the Lahman package. Draw another diagram that shows the relationship between `Master`, `Managers`, `AwardsManagers`.

**`Batting$playerID` connects to `Master$playerID`. `Salaries$playerID` connects to `Master$playerID`. `Batting` and `Salaries` could be connected via `playerID`, `yearID`, and `teamID`.**

**`Master$playerID` connects to `Managers$playerID`. `Master$playerID` connects to `AwardsManagers$playerID`. `Managers` and `AwardsManagers` via `playerID` and `yearID`.**

How would you characterise the relationship between the `Batting`, `Pitching`, and `Fielding` tables?

```{r}
Batting
Pitching
Fielding
```

**They should have a one-to-one relationship with matching primary keys (`playerID`, `yearID`, `stint`) across the three tables - with most position players only having records for `Batting` and `Fielding`, while pitchers are likely to have records only in `Pitching` and `Fielding`.**
